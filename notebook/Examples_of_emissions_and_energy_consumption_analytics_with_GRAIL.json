{"version":"6","defaultTimeframe":{"from":"now()-24h","to":"now()"},"sections":[{"id":"e56ae578-2e12-440e-8692-bd1b7229ee5d","type":"markdown","markdown":"# Ad-hoc analysis of energy consumption and carbon emissions with GRAIL\n- this notebook contains DQL examples\n\n---\n---\nThis is a sample for educational purposes only and not officially part of the product.\nIf you have question, leave a comment on the github repo.\n\nFor more information about Dynatrace please visit [dynatrace.com](https://www.dynatrace.com)\n\n---\n---"},{"id":"15a33c1d-dfef-40b4-967a-8b2ce149c2fb","type":"markdown","markdown":"## 1 - Measure the energy consumption and carbon emissions from your digital infrastructure\nTo start collecting and build a base line of carbon emissions, you can use\n- [Carbon Impact app](https://www.dynatrace.com/hub/detail/carbon-impact/)\n- DQL (see example below : DQL request 1)"},{"id":"cbe4bc81-fd4f-464c-8302-8195918ab9a2","type":"markdown","markdown":"\n\n\n![Carbon Impact app](https://mkt-cdn.dynatrace.com/assets/Marketing/screenshots/carbon-footprint-header.png)"},{"id":"840794cc-9813-4f3c-b067-57d4990ed080","type":"markdown","markdown":"## Example of Measuring Energy Consumption and Carbon Emissions with Carbon Impact\n- Start enriching utilization metrics from your digital infrastructure into energy consumption and carbon emissions\n- for more detail click [here](https://www.dynatrace.com/hub/detail/carbon-impact/)\n\n\n![Green coding](https://mkt-cdn.dynatrace.com/assets/Marketing/screenshots/4-amac-green-coding.png)"},{"id":"d37dbc4d-6541-4c18-be0f-23834b881d5b","type":"markdown","markdown":"## Understanding Data of Emissions and Energy Consumption Analytics with DQL\n- **DQL request 1** = how does emissions and energy consumption data looks like in GRAIL"},{"id":"51c71058-a3f9-4d63-a0b7-8293f0e3e0db","type":"dql","showTitle":false,"height":276,"showInput":true,"drilldownPath":[],"state":{"input":{"value":"//Example of an hourly generated data point with emissions from a single host\nfetch bizevents\n| filter event.type == \"carbon.measurement\"\n| limit 1","timeframe":{"from":"now()-2h","to":"now()"}},"visualization":"recordView","state":"success","davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"carbon.intensity.last_update","categoryAxisLabel":"carbon.intensity.last_update","valueAxis":"carbon.emissions","valueAxisLabel":"carbon.emissions"},"fieldMapping":{"timestamp":"timestamp","leftAxisValues":["carbon.emissions"],"leftAxisDimensions":["carbon.intensity.last_update"]},"hiddenLegendFields":[]},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"cloudType","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{"[\"timestamp\"]":164,"[\"order_ID\"]":104,"[\"event.name\"]":175,"[\"status_step1\"]":138,"[\"status_step2\"]":133,"[\"status_step3\"]":133,"[\"status_step4\"]":133,"[\"status_step5\"]":437.375,"[\"error\"]":110.1388931274414,"[\"status\"]":88.54166412353516}},"honeycomb":{"shape":"square","legend":"auto","colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"carbon.emissions"},"displayedFields":["carbon.intensity.last_update"]},"histogram":{"dataMappings":[{"valueAxis":"carbon.emissions","rangeAxis":""},{"valueAxis":"carbon.intensity","rangeAxis":""},{"valueAxis":"energy.measurement.computing","rangeAxis":""},{"valueAxis":"energy.measurement.cooling","rangeAxis":""},{"valueAxis":"energy.measurement.cpu","rangeAxis":""},{"valueAxis":"energy.measurement.io","rangeAxis":""},{"valueAxis":"energy.measurement.memory","rangeAxis":""},{"valueAxis":"energy.measurement.network","rangeAxis":""},{"valueAxis":"energy.measurement.total","rangeAxis":""},{"valueAxis":"energy.pue","rangeAxis":""},{"valueAxis":"utilization.cpu.average","rangeAxis":""},{"valueAxis":"utilization.network.average","rangeAxis":""}]}},"result":{"code":200,"value":{"records":[{"timestamp":"2024-08-06T13:00:23.014000000Z","carbon.emissions":4.663893289701603,"carbon.intensity":0.379069,"carbon.intensity.last_update":"2024-05-01T00:00:00.000Z","carbon.intensity.origin":"geographical","cloud.provider":"Amazon","cloud.region":"us-east-1","dt.entity.host":"HOST-0996B3922AB00D9D","dt.openpipeline.pipelines":["bizevents:default"],"dt.openpipeline.source":"/api/v2/bizevents/ingest","energy.measurement.computing":3.847110543547375,"energy.measurement.cooling":1.4634174946093381,"energy.measurement.cpu":3.847110543547375,"energy.measurement.cpu_unknown":false,"energy.measurement.io":0.04496811032295227,"energy.measurement.memory":1.4791875,"energy.measurement.network":5.468863435828479,"energy.measurement.total":10.840129589698805,"energy.pue":1.135,"energy.pue.origin":"aws","event.end":"1722949200000","event.id":"94406781-4891-4c3e-8d2f-b3850681e17e","event.kind":"BIZ_EVENT","event.provider":"dynatrace.biz.carbon","event.start":"1722945600000","event.type":"carbon.measurement","system.model":"t3.medium","system.processor.model":"Intel(R) Xeon(R) Platinum 8175M CPU @ 2.50GHz","utilization.cpu.average":5.137772102140417,"utilization.network.average":1631152.0557759383}],"metadata":{"grail":{"canonicalQuery":"fetch bizevents\n| filter event.type == \"carbon.measurement\"\n| limit 1","timezone":"Z","query":"//Example of an hourly generated data point with emissions from a single host\nfetch bizevents\n| filter event.type == \"carbon.measurement\"\n| limit 1","scannedRecords":121515,"dqlVersion":"V1_0","scannedBytes":5166280,"scannedDataPoints":0,"analysisTimeframe":{"start":"2024-08-06T11:58:22.594Z","end":"2024-08-06T13:58:22.594Z"},"locale":"und","executionTimeMilliseconds":16,"notifications":[],"queryId":"09a2c808-7607-437f-9248-d74685e979ba","sampled":false}},"types":[{"mappings":{"timestamp":{"type":"timestamp"},"carbon.emissions":{"type":"double"},"carbon.intensity":{"type":"double"},"carbon.intensity.last_update":{"type":"string"},"carbon.intensity.origin":{"type":"string"},"cloud.provider":{"type":"string"},"cloud.region":{"type":"string"},"dt.entity.host":{"type":"string"},"dt.openpipeline.pipelines":{"type":"array","types":[{"mappings":{"element":{"type":"string"}},"indexRange":[0,0]}]},"dt.openpipeline.source":{"type":"string"},"energy.measurement.computing":{"type":"double"},"energy.measurement.cooling":{"type":"double"},"energy.measurement.cpu":{"type":"double"},"energy.measurement.cpu_unknown":{"type":"boolean"},"energy.measurement.io":{"type":"double"},"energy.measurement.memory":{"type":"double"},"energy.measurement.network":{"type":"double"},"energy.measurement.total":{"type":"double"},"energy.pue":{"type":"double"},"energy.pue.origin":{"type":"string"},"event.end":{"type":"string"},"event.id":{"type":"string"},"event.kind":{"type":"string"},"event.provider":{"type":"string"},"event.start":{"type":"string"},"event.type":{"type":"string"},"system.model":{"type":"string"},"system.processor.model":{"type":"string"},"utilization.cpu.average":{"type":"double"},"utilization.network.average":{"type":"double"}},"indexRange":[0,0]}]},"notifications":[],"dateTime":"2024-08-06T13:58:22.900Z","input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"//Example of an hourly generated data point with emissions from a single host\nfetch bizevents\n| filter event.type == \"carbon.measurement\"\n| limit 1"},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}}},{"id":"016b96a4-1399-479f-b7c1-2f890342f07e","type":"markdown","markdown":"# 2 - Ad-hoc Analysis of Energy Consumption and Carbon Emissions\n- DQL request 2 = Top 10 contributors at host level\n- DQL request 3 = Distribution of Energy Consumptions and Carbon Emissions by cloud type\n- DQL request 4 = Distribution of Carbon Emissions by VMWare hyperVisor"},{"id":"cb9f9036-4eb4-4a66-8e90-c47598b941fa","type":"markdown","markdown":"## Example of Emissions and Energy Consumption Analytics with DQL\n- **DQL request 2** = who are the top 10 contributors to the energy consumption and carbon emissions"},{"id":"67ce0a47-0542-4828-906e-9f2cf964c1a1","type":"dql","showTitle":false,"height":198,"showInput":true,"drilldownPath":[],"state":{"input":{"value":"//Example of indentifying main contributors to energy consumption and carbon emissions\nfetch bizevents\n| filter event.provider == \"dynatrace.biz.carbon\"\n| filter event.type == \"carbon.measurement\"\n| lookup sourceField:dt.entity.host, lookupField:id, prefix:\"host.\",[fetch dt.entity.host ]\n| summarize {`Total Emissions (g CO2e)` = sum(carbon.emissions), \n    `Total Energy (Wh)` = sum(energy.measurement.total)},\n    by:{host.entity.name, dt.entity.host, cloud.region}\n| fieldsAdd `Average Carbon Intensity`=`Total Emissions (g CO2e)`/ `Total Energy (Wh)`\n| sort (`Total Emissions (g CO2e)`) desc\n| limit 10","timeframe":{"from":"now-7d","to":"now","details":{"from":{"type":"expression","normalized":"now-7d","date":"2024-03-19T11:45:46.715Z"},"to":{"type":"expression","normalized":"now","date":"2024-03-26T11:45:46.715Z"}}}},"visualization":"table","state":"success","davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"host.entity.name","categoryAxisLabel":"host.entity.name","valueAxis":"Total Emissions (g CO2e)","valueAxisLabel":"Total Emissions (g CO2e)"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"cloudType","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{"[\"timestamp\"]":164,"[\"order_ID\"]":104,"[\"event.name\"]":175,"[\"status_step1\"]":138,"[\"status_step2\"]":133,"[\"status_step3\"]":133,"[\"status_step4\"]":133,"[\"status_step5\"]":437.375,"[\"error\"]":110.1388931274414,"[\"status\"]":88.54166412353516}},"honeycomb":{"shape":"square","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"Total Emissions (g CO2e)"},"displayedFields":["host.entity.name"]},"histogram":{"dataMappings":[{"valueAxis":"Total Emissions (g CO2e)","rangeAxis":""},{"valueAxis":"Total Energy (Wh)","rangeAxis":""},{"valueAxis":"Average Carbon Intensity","rangeAxis":""}]}},"result":{"code":200,"value":{"records":[{"host.entity.name":"chy86584.lab.dynatrace.org","dt.entity.host":"HOST-C25D04CF17D4A5C0","cloud.region":"Szczecin, Poland","Total Emissions (g CO2e)":34378.46582616212,"Total Energy (Wh)":30178.2561370127,"Average Carbon Intensity":1.1391799999999999},{"host.entity.name":"ip-10-176-64-209.ec2.internal","dt.entity.host":"HOST-386D17BF13ADAF01","cloud.region":"us-east-1","Total Emissions (g CO2e)":1004.0256971785914,"Total Energy (Wh)":2333.6230039474076,"Average Carbon Intensity":0.4302433150000003},{"host.entity.name":"ip-10-176-64-253.ec2.internal","dt.entity.host":"HOST-0996B3922AB00D9D","cloud.region":"us-east-1","Total Emissions (g CO2e)":691.1794252393314,"Total Energy (Wh)":1606.4849845240049,"Average Carbon Intensity":0.4302433149999999},{"host.entity.name":"ip-10-176-64-22.ec2.internal","dt.entity.host":"HOST-A45FB8F21C55EBAD","cloud.region":"us-east-1","Total Emissions (g CO2e)":629.2876824895033,"Total Energy (Wh)":1462.6320980478297,"Average Carbon Intensity":0.430243315}],"metadata":{"grail":{"canonicalQuery":"fetch bizevents\n| filter event.provider == \"dynatrace.biz.carbon\"\n| filter event.type == \"carbon.measurement\"\n| lookup [fetch dt.entity.host], sourceField:dt.entity.host, lookupField:id, prefix:\"host.\"\n| summarize by:{host.entity.name, dt.entity.host, cloud.region}, {`Total Emissions (g CO2e)` = sum(carbon.emissions), `Total Energy (Wh)` = sum(energy.measurement.total)}\n| fieldsAdd `Average Carbon Intensity` = `Total Emissions (g CO2e)` / `Total Energy (Wh)`\n| sort `Total Emissions (g CO2e)` desc\n| limit 10","timezone":"Z","query":"//Example of indentifying main contributors to energy consumption and carbon emissions\nfetch bizevents\n| filter event.provider == \"dynatrace.biz.carbon\"\n| filter event.type == \"carbon.measurement\"\n| lookup sourceField:dt.entity.host, lookupField:id, prefix:\"host.\",[fetch dt.entity.host ]\n| summarize {`Total Emissions (g CO2e)` = sum(carbon.emissions), \n    `Total Energy (Wh)` = sum(energy.measurement.total)},\n    by:{host.entity.name, dt.entity.host, cloud.region}\n| fieldsAdd `Average Carbon Intensity`=`Total Emissions (g CO2e)`/ `Total Energy (Wh)`\n| sort (`Total Emissions (g CO2e)`) desc\n| limit 10","scannedRecords":8349783,"dqlVersion":"V1_0","scannedBytes":355407240,"scannedDataPoints":0,"analysisTimeframe":{"start":"2024-07-30T13:55:45.496Z","end":"2024-08-06T13:55:45.496Z"},"locale":"und","executionTimeMilliseconds":533,"notifications":[],"queryId":"7516f4a4-0ae7-4ef0-a30c-bdbf6d3d54d8","sampled":false}},"types":[{"mappings":{"host.entity.name":{"type":"string"},"dt.entity.host":{"type":"string"},"cloud.region":{"type":"string"},"Total Emissions (g CO2e)":{"type":"double"},"Total Energy (Wh)":{"type":"double"},"Average Carbon Intensity":{"type":"double"}},"indexRange":[0,3]}]},"notifications":[],"dateTime":"2024-08-06T13:55:46.866Z","input":{"timeframe":{"from":"now-7d","to":"now","details":{"from":{"type":"expression","normalized":"now-7d","date":"2024-03-19T11:45:46.715Z"},"to":{"type":"expression","normalized":"now","date":"2024-03-26T11:45:46.715Z"}}},"value":"//Example of indentifying main contributors to energy consumption and carbon emissions\nfetch bizevents\n| filter event.provider == \"dynatrace.biz.carbon\"\n| filter event.type == \"carbon.measurement\"\n| lookup sourceField:dt.entity.host, lookupField:id, prefix:\"host.\",[fetch dt.entity.host ]\n| summarize {`Total Emissions (g CO2e)` = sum(carbon.emissions), \n    `Total Energy (Wh)` = sum(energy.measurement.total)},\n    by:{host.entity.name, dt.entity.host, cloud.region}\n| fieldsAdd `Average Carbon Intensity`=`Total Emissions (g CO2e)`/ `Total Energy (Wh)`\n| sort (`Total Emissions (g CO2e)`) desc\n| limit 10"},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}}},{"id":"d6a3ff67-2e81-4be0-b650-22077f8d9963","type":"markdown","markdown":"## Example of Emissions and Energy Consumption Analytics with DQL\n- **DQL request 3** = how much energy is consumed and how much carbon is generated by hyperscaler"},{"id":"f7b40e4a-dbe4-470c-ac4d-a5930dd26eb3","type":"dql","showTitle":false,"height":198,"showInput":true,"state":{"input":{"value":"//Example of energy consumption by hyperscalers or on-premise\nfetch bizevents\n| filter event.provider == \"dynatrace.biz.carbon\"\n| filter event.type == \"carbon.measurement\"\n| lookup sourceField:dt.entity.host, lookupField:id, [fetch dt.entity.host | fieldsAdd cloudType]\n| summarize \n  {`CPU Energy (Wh)`=sum(energy.measurement.cpu),\n  `StorageIO Energy (Wh)`=sum(energy.measurement.io),\n  `Memory Energy (Wh)`=sum(energy.measurement.memory),\n  `Network Energy (Wh)`=sum(energy.measurement.network),\n  `Total Emissions (g CO2e)` = sum(carbon.emissions),\n  `Total Number of Cores`= sum(lookup.cpuCores)}, by: {`Cloud Type`=lookup.cloudType}\n| fieldsAdd `Cloud Type`=if(isNull(`Cloud Type`),\"ON_PREMISE\", else:`Cloud Type`)\n| fieldsAdd `Avg Emissions per core (g CO2e)` = `Total Emissions (g CO2e)` / `Total Number of Cores`","timeframe":{"from":"now()-24h","to":"now()"}},"visualization":"table","state":"success","davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Cloud Type","categoryAxisLabel":"Cloud Type","valueAxis":"CPU Energy (Wh)","valueAxisLabel":"CPU Energy (Wh)"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"cloudType","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{"[\"timestamp\"]":164,"[\"order_ID\"]":104,"[\"event.name\"]":175,"[\"status_step1\"]":138,"[\"status_step2\"]":133,"[\"status_step3\"]":133,"[\"status_step4\"]":133,"[\"status_step5\"]":437.375,"[\"error\"]":110.1388931274414,"[\"status\"]":88.54166412353516}},"honeycomb":{"shape":"square","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"CPU Energy (Wh)"},"displayedFields":["Cloud Type"]},"histogram":{"dataMappings":[{"valueAxis":"CPU Energy (Wh)","rangeAxis":""},{"valueAxis":"StorageIO Energy (Wh)","rangeAxis":""},{"valueAxis":"Memory Energy (Wh)","rangeAxis":""},{"valueAxis":"Network Energy (Wh)","rangeAxis":""},{"valueAxis":"Total Emissions (g CO2e)","rangeAxis":""},{"valueAxis":"Total Number of Cores","rangeAxis":""},{"valueAxis":"Avg Emissions per core (g CO2e)","rangeAxis":""}]}},"result":{"code":200,"value":{"records":[{"Cloud Type":"EC2","CPU Energy (Wh)":423.3659879626447,"StorageIO Energy (Wh)":3.2464624643325806,"Memory Energy (Wh)":141.32198144531253,"Network Energy (Wh)":335.54180450243257,"Total Emissions (g CO2e)":388.7146109615842,"Total Number of Cores":72,"Avg Emissions per core (g CO2e)":5.398814041133114},{"Cloud Type":"ON_PREMISE","CPU Energy (Wh)":4976.744344887355,"StorageIO Energy (Wh)":1.7509982854127881,"Memory Energy (Wh)":72.99874291992187,"Network Energy (Wh)":10.358674745206265,"Total Emissions (g CO2e)":5766.361428091314,"Total Number of Cores":96,"Avg Emissions per core (g CO2e)":60.06626487595119}],"metadata":{"grail":{"canonicalQuery":"fetch bizevents\n| filter event.provider == \"dynatrace.biz.carbon\"\n| filter event.type == \"carbon.measurement\"\n| lookup \n\t[\n\t\tfetch dt.entity.host\n\t\t| fieldsAdd cloudType\n\t], sourceField:dt.entity.host, lookupField:id\n| summarize by:{`Cloud Type` = lookup.cloudType}, {`CPU Energy (Wh)` = sum(energy.measurement.cpu), `StorageIO Energy (Wh)` = sum(energy.measurement.io), `Memory Energy (Wh)` = sum(energy.measurement.memory), `Network Energy (Wh)` = sum(energy.measurement.network), `Total Emissions (g CO2e)` = sum(carbon.emissions), `Total Number of Cores` = sum(lookup.cpuCores)}\n| fieldsAdd `Cloud Type` = if(isNull(`Cloud Type`), \"ON_PREMISE\", else:`Cloud Type`)\n| fieldsAdd `Avg Emissions per core (g CO2e)` = `Total Emissions (g CO2e)` / `Total Number of Cores`","timezone":"Z","query":"//Example of energy consumption by hyperscalers or on-premise\nfetch bizevents\n| filter event.provider == \"dynatrace.biz.carbon\"\n| filter event.type == \"carbon.measurement\"\n| lookup sourceField:dt.entity.host, lookupField:id, [fetch dt.entity.host | fieldsAdd cloudType]\n| summarize \n  {`CPU Energy (Wh)`=sum(energy.measurement.cpu),\n  `StorageIO Energy (Wh)`=sum(energy.measurement.io),\n  `Memory Energy (Wh)`=sum(energy.measurement.memory),\n  `Network Energy (Wh)`=sum(energy.measurement.network),\n  `Total Emissions (g CO2e)` = sum(carbon.emissions),\n  `Total Number of Cores`= sum(lookup.cpuCores)}, by: {`Cloud Type`=lookup.cloudType}\n| fieldsAdd `Cloud Type`=if(isNull(`Cloud Type`),\"ON_PREMISE\", else:`Cloud Type`)\n| fieldsAdd `Avg Emissions per core (g CO2e)` = `Total Emissions (g CO2e)` / `Total Number of Cores`","scannedRecords":1165810,"dqlVersion":"V1_0","scannedBytes":49720059,"scannedDataPoints":0,"analysisTimeframe":{"start":"2024-08-05T13:59:17.115Z","end":"2024-08-06T13:59:17.115Z"},"locale":"und","executionTimeMilliseconds":63,"notifications":[],"queryId":"85042600-a923-4a77-8c70-3200c0c3b282","sampled":false}},"types":[{"mappings":{"Cloud Type":{"type":"string"},"CPU Energy (Wh)":{"type":"double"},"StorageIO Energy (Wh)":{"type":"double"},"Memory Energy (Wh)":{"type":"double"},"Network Energy (Wh)":{"type":"double"},"Total Emissions (g CO2e)":{"type":"double"},"Total Number of Cores":{"type":"double"},"Avg Emissions per core (g CO2e)":{"type":"double"}},"indexRange":[0,1]}]},"notifications":[],"dateTime":"2024-08-06T13:59:17.435Z","input":{"timeframe":{"from":"now()-24h","to":"now()"},"value":"//Example of energy consumption by hyperscalers or on-premise\nfetch bizevents\n| filter event.provider == \"dynatrace.biz.carbon\"\n| filter event.type == \"carbon.measurement\"\n| lookup sourceField:dt.entity.host, lookupField:id, [fetch dt.entity.host | fieldsAdd cloudType]\n| summarize \n  {`CPU Energy (Wh)`=sum(energy.measurement.cpu),\n  `StorageIO Energy (Wh)`=sum(energy.measurement.io),\n  `Memory Energy (Wh)`=sum(energy.measurement.memory),\n  `Network Energy (Wh)`=sum(energy.measurement.network),\n  `Total Emissions (g CO2e)` = sum(carbon.emissions),\n  `Total Number of Cores`= sum(lookup.cpuCores)}, by: {`Cloud Type`=lookup.cloudType}\n| fieldsAdd `Cloud Type`=if(isNull(`Cloud Type`),\"ON_PREMISE\", else:`Cloud Type`)\n| fieldsAdd `Avg Emissions per core (g CO2e)` = `Total Emissions (g CO2e)` / `Total Number of Cores`"},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"drilldownPath":[]},{"id":"9266831d-0de7-4e98-ae1d-27a0abe4ce70","type":"markdown","markdown":"## Example of Emissions and Energy Consumption Analytics with DQL\n- **DQL request 4** = Summarization based on VMWare hypervisor"},{"id":"57cc7980-c8e0-4aff-a339-f5d5bdd6dc15","type":"dql","showTitle":false,"height":98,"showInput":true,"state":{"input":{"value":"//Example of emissions by VMWare hypervisors\nfetch dt.entity.host \n| fieldsAdd hypervisorType\n| fieldsAdd dt.entity.hypervisor = runs_on[dt.entity.hypervisor]\n| filterOut isNull(dt.entity.hypervisor)\n| fields id, hypervisorId = dt.entity.hypervisor\n| lookup sourceField:id, lookupField:dt.entity.host, [fetch bizevents\n  | filter event.type==\"carbon.measurement\"\n  | summarize emissions = sum(carbon.emissions), by:{dt.entity.host}], prefix:\"carbon.\"\n| lookup sourceField:hypervisorId, lookupField:id, [fetch dt.entity.hypervisor]\n| fieldsAdd `Hypervisor Name` = lookup.entity.name\n| fieldsAdd `Carbon emissions (g CO2e)`= carbon.emissions\n| fieldsRemove \"lookup*\",\"carbon*\"\n| summarize `Carbon emissions (g CO2e)`= sum(`Carbon emissions (g CO2e)`), by:{`Hypervisor Name`, `Hypervisor Id`=hypervisorId}","timeframe":{"from":"now-7d","to":"now","details":{"from":{"type":"expression","normalized":"now-7d","date":"2024-03-19T11:45:46.715Z"},"to":{"type":"expression","normalized":"now","date":"2024-03-26T11:45:46.715Z"}}}},"visualization":"table","state":"success","davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxisLabel":"Cloud Type","valueAxisLabel":"CPU Energy (Wh)"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"cloudType","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{"[\"timestamp\"]":164,"[\"order_ID\"]":104,"[\"event.name\"]":175,"[\"status_step1\"]":138,"[\"status_step2\"]":133,"[\"status_step3\"]":133,"[\"status_step4\"]":133,"[\"status_step5\"]":437.375,"[\"error\"]":110.1388931274414,"[\"status\"]":88.54166412353516}},"honeycomb":{"shape":"square","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"categorical","dataMappings":{},"displayedFields":[]},"histogram":{"dataMappings":[]}},"result":{"code":200,"value":{"records":[],"metadata":{"grail":{"canonicalQuery":"fetch dt.entity.host\n| fieldsAdd hypervisorType\n| fieldsAdd dt.entity.hypervisor = runs_on[dt.entity.hypervisor]\n| filterOut isNull(dt.entity.hypervisor)\n| fields id, hypervisorId = dt.entity.hypervisor\n| lookup \n\t[\n\t\tfetch bizevents\n\t\t| filter event.type == \"carbon.measurement\"\n\t\t| summarize by:{dt.entity.host}, emissions = sum(carbon.emissions)\n\t], sourceField:id, lookupField:dt.entity.host, prefix:\"carbon.\"\n| lookup [fetch dt.entity.hypervisor], sourceField:hypervisorId, lookupField:id\n| fieldsAdd `Hypervisor Name` = lookup.entity.name\n| fieldsAdd `Carbon emissions (g CO2e)` = carbon.emissions\n| fieldsRemove \"lookup*\", \"carbon*\"\n| summarize by:{`Hypervisor Name`, `Hypervisor Id` = hypervisorId}, `Carbon emissions (g CO2e)` = sum(`Carbon emissions (g CO2e)`)","timezone":"Z","query":"//Example of emissions by VMWare hypervisors\nfetch dt.entity.host \n| fieldsAdd hypervisorType\n| fieldsAdd dt.entity.hypervisor = runs_on[dt.entity.hypervisor]\n| filterOut isNull(dt.entity.hypervisor)\n| fields id, hypervisorId = dt.entity.hypervisor\n| lookup sourceField:id, lookupField:dt.entity.host, [fetch bizevents\n  | filter event.type==\"carbon.measurement\"\n  | summarize emissions = sum(carbon.emissions), by:{dt.entity.host}], prefix:\"carbon.\"\n| lookup sourceField:hypervisorId, lookupField:id, [fetch dt.entity.hypervisor]\n| fieldsAdd `Hypervisor Name` = lookup.entity.name\n| fieldsAdd `Carbon emissions (g CO2e)`= carbon.emissions\n| fieldsRemove \"lookup*\",\"carbon*\"\n| summarize `Carbon emissions (g CO2e)`= sum(`Carbon emissions (g CO2e)`), by:{`Hypervisor Name`, `Hypervisor Id`=hypervisorId}","scannedRecords":8353167,"dqlVersion":"V1_0","scannedBytes":355550461,"scannedDataPoints":0,"analysisTimeframe":{"start":"2024-07-30T13:59:58.360Z","end":"2024-08-06T13:59:58.360Z"},"locale":"und","executionTimeMilliseconds":739,"notifications":[],"queryId":"67c97417-691a-48f6-9693-e72411587a72","sampled":false}},"types":[]},"notifications":[],"dateTime":"2024-08-06T13:59:59.709Z","input":{"timeframe":{"from":"now-7d","to":"now","details":{"from":{"type":"expression","normalized":"now-7d","date":"2024-03-19T11:45:46.715Z"},"to":{"type":"expression","normalized":"now","date":"2024-03-26T11:45:46.715Z"}}},"value":"//Example of emissions by VMWare hypervisors\nfetch dt.entity.host \n| fieldsAdd hypervisorType\n| fieldsAdd dt.entity.hypervisor = runs_on[dt.entity.hypervisor]\n| filterOut isNull(dt.entity.hypervisor)\n| fields id, hypervisorId = dt.entity.hypervisor\n| lookup sourceField:id, lookupField:dt.entity.host, [fetch bizevents\n  | filter event.type==\"carbon.measurement\"\n  | summarize emissions = sum(carbon.emissions), by:{dt.entity.host}], prefix:\"carbon.\"\n| lookup sourceField:hypervisorId, lookupField:id, [fetch dt.entity.hypervisor]\n| fieldsAdd `Hypervisor Name` = lookup.entity.name\n| fieldsAdd `Carbon emissions (g CO2e)`= carbon.emissions\n| fieldsRemove \"lookup*\",\"carbon*\"\n| summarize `Carbon emissions (g CO2e)`= sum(`Carbon emissions (g CO2e)`), by:{`Hypervisor Name`, `Hypervisor Id`=hypervisorId}"},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"drilldownPath":[]},{"id":"d4c94252-69ce-4271-8007-d8072576daab","type":"markdown","markdown":"# 3 - Green Coding: Measuring carbon footprint on software individuals on your IT stack\nStart an analysis to measure a baseline to validate green coding initiatives\n\n- DQL request 5 = Getting emissions distributed by Process Instances\n- DQL request 6 = Get backwards emissions at minute granularity in last hour\n"},{"id":"13ada9c7-d403-49e6-90cb-05d6fca307e8","type":"markdown","markdown":"## Example of Emissions and Energy Consumption by Software Individuals with DQL\n- **DQL request 5** = Getting emissions distributed by Process Group Instances"},{"id":"bc765848-39e5-4e4f-b857-1e6b5e418e86","type":"dql","showTitle":false,"height":263,"showInput":true,"state":{"input":{"value":"//Example of emissions by processes\nfetch dt.entity.process_group_instance\n| fields entity.name, dt.entity.host=belongs_to[dt.entity.host],\n  dt.entity.process_group= instance_of[dt.entity.process_group],\n  dt.entity.process_group_instance = id\n| lookup sourceField:dt.entity.host, lookupField:dt.entity.host, [fetch bizevents\n  | filter event.type==\"carbon.measurement\"\n  | summarize sum = sum(carbon.emissions), by:{dt.entity.host}], prefix:\"carbon.\"\n| filter isNotNull(carbon.sum)\n| lookup [timeseries ts=avg(dt.process.cpu.usage), \n  by:{dt.entity.process_group_instance}\n  | fields cpu_sum= arraySum(ts), dt.entity.process_group_instance],sourceField:dt.entity.process_group_instance, \n  lookupField:dt.entity.process_group_instance\n| fieldsAdd cpu_sum=lookup.cpu_sum\n| fieldsRename carbon_per_host=carbon.sum\n| fieldsRemove \"lookup*\"\n| lookup [timeseries ts=avg(dt.process.cpu.usage),  by:{dt.entity.process_group_instance}\n  | lookup [fetch dt.entity.process_group_instance], sourceField:dt.entity.process_group_instance, lookupField:id\n  | fields ts, dt.entity.process_group_instance, dt.entity.host = lookup.belongs_to[dt.entity.host]\n  | lookup [fetch dt.entity.process_group_instance], sourceField:dt.entity.process_group_instance, lookupField:id\n  | fieldsAdd cpusum = arraySum(ts)\n  | summarize cpuHostSum = sum(cpusum), by:{dt.entity.host}],\n  sourceField:dt.entity.host, lookupField:dt.entity.host\n| fieldsAdd carbon_per_process = (if(isNull(cpu_sum),0,else:cpu_sum)/lookup.cpuHostSum) * carbon_per_host\n| fields dt.entity.host,dt.entity.process_group, dt.entity.process_group_instance, \n  dt.entity.process_group_instance.name = entity.name, carbon_per_process\n| sort carbon_per_process desc \n\n","timeframe":{"from":"now-7d","to":"now","details":{"from":{"type":"expression","normalized":"now-7d","date":"2024-03-19T11:45:46.715Z"},"to":{"type":"expression","normalized":"now","date":"2024-03-26T11:45:46.715Z"}}}},"visualization":"table","state":"success","davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxisLabel":"dt.entity.process_group_instance.name","valueAxisLabel":"carbon_per_process","categoryAxis":"dt.entity.process_group_instance.name","valueAxis":"carbon_per_process"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"cloudType","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{"[\"timestamp\"]":164,"[\"order_ID\"]":104,"[\"event.name\"]":175,"[\"status_step1\"]":138,"[\"status_step2\"]":133,"[\"status_step3\"]":133,"[\"status_step4\"]":133,"[\"status_step5\"]":437.375,"[\"error\"]":110.1388931274414,"[\"status\"]":88.54166412353516},"sortBy":{"columnId":"[\"carbon_per_process\"]","direction":"descending"}},"honeycomb":{"shape":"square","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"carbon_per_process"},"displayedFields":["dt.entity.host"]},"histogram":{"dataMappings":[{"valueAxis":"carbon_per_process","rangeAxis":""}]}},"result":{"code":200,"value":{"records":[{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-A6DEABAF1F8B8C05","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-50B036E9DB39B331","dt.entity.process_group_instance.name":"chrome","carbon_per_process":22407.519536191077},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-216FDBEF8325B5C6","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-209404826A9EC5AF","dt.entity.process_group_instance.name":"OneAgent log analytics","carbon_per_process":3365.219995187109},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-FCA4DC722E7E6F67","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-580CC72EC4F0B96C","dt.entity.process_group_instance.name":"BrokerService.dll","carbon_per_process":2127.002787782529},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-61469567CF460DC4","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-AE3FFC552055CCCA","dt.entity.process_group_instance.name":"easyTradeManager.dll","carbon_per_process":1422.9581789923632},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-814B6D4A66600EC4","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-2482776F29DA70CA","dt.entity.process_group_instance.name":"build/src/main.js (easytrade-load-generator)","carbon_per_process":1203.3405908397713},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-E032983A9951A616","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-B16E746287737BC7","dt.entity.process_group_instance.name":"nginx","carbon_per_process":802.3279797123336},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-3AD9FB79C914520C","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-365558AA921D1F4A","dt.entity.process_group_instance.name":"OneAgent system monitoring","carbon_per_process":703.0124993996482},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-F006F48E6354A1E2","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-54594C7C7F014A4F","dt.entity.process_group_instance.name":"et_distributed-BusinessBackend","carbon_per_process":596.4195193110354},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-78241B26B4514A28","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-24412E3CC46D1F45","dt.entity.process_group_instance.name":"chromium-browser","carbon_per_process":590.6727851543519},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-0DCA2E90E920D9A8","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-72637C07F22B8B72","dt.entity.process_group_instance.name":"src/app.js (easytrade_offer_service)","carbon_per_process":470.61422950462236},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-1374F39E2F196DDD","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-1AE2400C05A96040","dt.entity.process_group_instance.name":"et_distributed-CustomerFrontend","carbon_per_process":424.6367792142118},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-EDF5B76E800EDC7B","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-E2A8FF90F0AB1892","dt.entity.process_group_instance.name":"dist/app.js (easytrade_aggregator_service)","carbon_per_process":378.3170251227286},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-B47B5DC6BE1E0869","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-0A8CB7C239030514","dt.entity.process_group_instance.name":"MSSQL","carbon_per_process":302.72753719194236},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-01C44D67C0BA35F8","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-115F68B621166C03","dt.entity.process_group_instance.name":"build/main.js (serve)","carbon_per_process":294.8248034418813},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-2DAB3C34331CF10D","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-A87160CAA13A593E","dt.entity.process_group_instance.name":"easyTradeLoginService.dll","carbon_per_process":286.65722607312944},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-30930A71B0E64CAD","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-08FE1DCEA34BE3AC","dt.entity.process_group_instance.name":"com.dynatrace.easytravel.weblauncher.jar easytravel-*-x*","carbon_per_process":269.4033467343361},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-CB73803BCA029030","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-092E84F4DDD635F0","dt.entity.process_group_instance.name":"SpringBoot com.dynatrace.easytrade.featureflagservice.Featureflagservi","carbon_per_process":164.63326017113354},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-3DF611514210702D","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-2E2A673E124F9D69","dt.entity.process_group_instance.name":"pricing-service","carbon_per_process":142.27474851312502},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-434D2CB12C2438DC","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-E079D8D8CE61AEA7","dt.entity.process_group_instance.name":"RabbitMQ","carbon_per_process":139.3846134014147},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-C7AAF4155E419875","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-CE3C478774F195E8","dt.entity.process_group_instance.name":"com.dynatrace.easytravel.customer.frontend.rest.jar easytravel-*-x*","carbon_per_process":129.14355414626291},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-8A0DF0F9C446635C","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-7F7B63AD41F1CC0C","dt.entity.process_group_instance.name":"containerd-shim-runc-v*","carbon_per_process":102.6368018455891},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-FD0B72E518820422","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-3F56762A0F56A1E2","dt.entity.process_group_instance.name":"SpringBoot com.dynatrace.easytrade.creditcardorderservice.Application","carbon_per_process":102.37235646095922},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-CA53C3AD7F624DF9","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-080EC76268B6E839","dt.entity.process_group_instance.name":"SpringBoot com.dynatrace.easytrade.accountservice.AccountServiceApplic","carbon_per_process":102.22067805162654},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-EF1E81586EB8EDD6","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-789EBEF35C27B383","dt.entity.process_group_instance.name":"Linux System","carbon_per_process":82.73823450635273},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-EA09344E1C34FC0C","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-CC48280CBC976FF7","dt.entity.process_group_instance.name":"chromedriver_linux64","carbon_per_process":66.90585361945848},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-AB4B7D387A667146","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-691679F76DB2D486","dt.entity.process_group_instance.name":"SpringBoot com.dynatrace.easytrade.engine.EngineApplication","carbon_per_process":65.77703358853135},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-4ABE306A4CADDBF7","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-72D327D55F0074F6","dt.entity.process_group_instance.name":"Apache Web Server easyTravel","carbon_per_process":56.64865255498541},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-3AD9FB79C914520C","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-40AF8D8E647CE3CD","dt.entity.process_group_instance.name":"OneAgent system monitoring","carbon_per_process":53.38392336377841},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-1E5C16FA9AB37B4D","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-DC0112358D67DE8D","dt.entity.process_group_instance.name":"SpringBoot com.dynatrace.easytrade.thirdpartyservice.Application","carbon_per_process":46.82159666248723},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-55BB99EBACB51463","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-F29BC37904F52F43","dt.entity.process_group_instance.name":"OneAgent network monitoring","carbon_per_process":45.05750627473263},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-84BDFE4C992AF3B4","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-9F3CED1245E56393","dt.entity.process_group_instance.name":"app.jar","carbon_per_process":44.69026049612312},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-55BB99EBACB51463","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-D51A07223E47CF59","dt.entity.process_group_instance.name":"OneAgent network monitoring","carbon_per_process":42.94215876990086},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-C502EE94E25BA6BF","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-CC945D06C8EBAB22","dt.entity.process_group_instance.name":"com.dynatrace.easytravel.cmdlauncher.jar easytravel-*-x*","carbon_per_process":30.11347537533011},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-A3247EA16405B304","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-B9C98F99687B8550","dt.entity.process_group_instance.name":"consumeCandleData","carbon_per_process":26.687406431670723},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-441B2CB89962033D","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-E044944A8537E890","dt.entity.process_group_instance.name":"easytravel-*-x*","carbon_per_process":18.004439644916076},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-3AD9FB79C914520C","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-925D8126329E40D3","dt.entity.process_group_instance.name":"OneAgent system monitoring","carbon_per_process":13.981501676937842},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-B27330900F0E858D","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-9E13F01D69453766","dt.entity.process_group_instance.name":"OneAgent monitoring extensions","carbon_per_process":11.804399966654866},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-216FDBEF8325B5C6","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-EB5FB3DF57FA6DF2","dt.entity.process_group_instance.name":"OneAgent log analytics","carbon_per_process":8.299456335208369},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-216FDBEF8325B5C6","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-DAA417F26EE7CF6E","dt.entity.process_group_instance.name":"OneAgent log analytics","carbon_per_process":7.505785809869514},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-3AD9FB79C914520C","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-D8B13992E20157E7","dt.entity.process_group_instance.name":"OneAgent system monitoring","carbon_per_process":7.3269768776527515},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-55BB99EBACB51463","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-9841EE8785B82644","dt.entity.process_group_instance.name":"OneAgent network monitoring","carbon_per_process":6.840396975486495},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-ECE82357AF59AF52","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-789CD0F4B5A4046B","dt.entity.process_group_instance.name":"Short-lived processes","carbon_per_process":5.3602879606647935},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-8BA2C7C18FB212B8","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-2FFD7F3393E7F915","dt.entity.process_group_instance.name":"com.dynatrace.easytravel.thirdpartycontent.server.jar easytravel-*-x*","carbon_per_process":5.3505982359499775},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-EF1E81586EB8EDD6","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-DA462E29EDF44273","dt.entity.process_group_instance.name":"Linux System","carbon_per_process":5.144633796313104},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-EF1E81586EB8EDD6","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-B838A5E2C52F989A","dt.entity.process_group_instance.name":"Linux System","carbon_per_process":4.556232827787934},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-B27330900F0E858D","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-55D8474054219F3B","dt.entity.process_group_instance.name":"OneAgent monitoring extensions","carbon_per_process":4.310272588052667},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-4F6264254199189E","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-7EA97E7B9B5BD091","dt.entity.process_group_instance.name":"OneAgent eBPF service discovery","carbon_per_process":4.05158626200754},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-C502EE94E25BA6BF","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-615D5666FE0E4D12","dt.entity.process_group_instance.name":"com.dynatrace.easytravel.cmdlauncher.jar easytravel-*-x*","carbon_per_process":3.9490004487933743},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-55BB99EBACB51463","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-2A8A2F6E93D972F9","dt.entity.process_group_instance.name":"OneAgent network monitoring","carbon_per_process":3.793644085187453},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-68B404144F1EFBEA","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-149025A7DB393D4D","dt.entity.process_group_instance.name":"systemd-resolved","carbon_per_process":3.5904384552454887},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-A979EAF2840DCDF6","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-F8C49ABCD99CD108","dt.entity.process_group_instance.name":"docker-compose","carbon_per_process":1.9884459540352317},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-ECE82357AF59AF52","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-9CE299502092865F","dt.entity.process_group_instance.name":"Short-lived processes","carbon_per_process":1.8897277777683705},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-216FDBEF8325B5C6","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-4696B8BF611F8BC2","dt.entity.process_group_instance.name":"OneAgent log analytics","carbon_per_process":1.4077253948787654},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-BE446907E5966CAB","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-052C94DB277E77B9","dt.entity.process_group_instance.name":"erlang","carbon_per_process":1.276353094097533},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-B27330900F0E858D","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-6423E36D6D3C3DA7","dt.entity.process_group_instance.name":"OneAgent monitoring extensions","carbon_per_process":0.9418872603723605},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-DA52C7DE4DCF26C3","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-781C15A525256AA4","dt.entity.process_group_instance.name":"snapd","carbon_per_process":0.7249035008632596},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-EF1E81586EB8EDD6","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-B4A690FDC886CE5B","dt.entity.process_group_instance.name":"Linux System","carbon_per_process":0.6467617325189372},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-B27330900F0E858D","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-F8114C2062C4790B","dt.entity.process_group_instance.name":"OneAgent monitoring extensions","carbon_per_process":0.5835957513838145},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-ECE82357AF59AF52","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-DBECBC6C524B7FEC","dt.entity.process_group_instance.name":"Short-lived processes","carbon_per_process":0.3965302875178979},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-68B404144F1EFBEA","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-5C89AC418ED718A7","dt.entity.process_group_instance.name":"systemd-resolved","carbon_per_process":0.313620976645722},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-ECE82357AF59AF52","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-E8F01B286C0ADF70","dt.entity.process_group_instance.name":"Short-lived processes","carbon_per_process":0.3069093625008212},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-DA52C7DE4DCF26C3","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-B9CEF8EEF9020E77","dt.entity.process_group_instance.name":"snapd","carbon_per_process":0.2744788326419079},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-C22F591B1DC26ABE","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-2BA65E436BE1EE5A","dt.entity.process_group_instance.name":"Dynatrace OneAgent Extensions Controller","carbon_per_process":0.2715867469934312},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-9EB94F678553846D","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-E8C0A19A4485B667","dt.entity.process_group_instance.name":"dockerd","carbon_per_process":0.27121282039747363},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-FDF8B0C3ADA13017","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-2A141DEA5EF88816","dt.entity.process_group_instance.name":"systemd-journald","carbon_per_process":0.21515373583316919},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-8C63D44215155DAB","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-5A2FF11D2A461702","dt.entity.process_group_instance.name":"bin/npm-cli.js (npm)","carbon_per_process":0.20957095771831155},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-BEA6CD8766CD22D8","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-D7826A0D3CAB1652","dt.entity.process_group_instance.name":"amazon-ssm-agent","carbon_per_process":0.20393478608551738},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-DA52C7DE4DCF26C3","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-B3D7A2F81841C2F9","dt.entity.process_group_instance.name":"snapd","carbon_per_process":0.1794910672413396},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-DA52C7DE4DCF26C3","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-72054FB3C466A62A","dt.entity.process_group_instance.name":"snapd","carbon_per_process":0.1603066185738713},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-FBDCEF665BCFA17A","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-FFDF709F121F9B20","dt.entity.process_group_instance.name":"Erlang Port Mapper","carbon_per_process":0.15457493083082352},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-1B68612B47F1E15A","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-BD6F8CDC41294404","dt.entity.process_group_instance.name":"java","carbon_per_process":0.10697577378657899},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-DA52C7DE4DCF26C3","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-822C06D5215C6065","dt.entity.process_group_instance.name":"snapd","carbon_per_process":0.04698849379195831},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-BEA6CD8766CD22D8","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-E679CE2005B6B4CE","dt.entity.process_group_instance.name":"amazon-ssm-agent","carbon_per_process":0.04475324484781211},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-DA52C7DE4DCF26C3","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-1E1EA9982EA424C9","dt.entity.process_group_instance.name":"snapd","carbon_per_process":0.03628844107694911},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-BEA6CD8766CD22D8","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-7A4B616D0A4EF062","dt.entity.process_group_instance.name":"amazon-ssm-agent","carbon_per_process":0.03490299018612269},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-68B404144F1EFBEA","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-A7BD227ACC57A9D0","dt.entity.process_group_instance.name":"systemd-resolved","carbon_per_process":0.03274118662381727},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-DA52C7DE4DCF26C3","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-43FEEB9EFD7B04B6","dt.entity.process_group_instance.name":"snapd","carbon_per_process":0.02947624758882747},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-DA52C7DE4DCF26C3","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-DFCC44D3F283401A","dt.entity.process_group_instance.name":"snapd","carbon_per_process":0.024172421425051424},{"dt.entity.host":"HOST-0996B3922AB00D9D","dt.entity.process_group":"PROCESS_GROUP-1CF7F9436E8B8C54","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-39295B62E78CCA7F","dt.entity.process_group_instance.name":"snap","carbon_per_process":0.021040420698705525},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-66DCBA89DB609155","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-B0909FD6E433DBFC","dt.entity.process_group_instance.name":"bin/npm-cli.js (npm)","carbon_per_process":0.016772747997390917},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-757E0AC139530C57","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-DE220E16AE08F699","dt.entity.process_group_instance.name":"Erlang","carbon_per_process":0.013985137316826064},{"dt.entity.host":"HOST-386D17BF13ADAF01","dt.entity.process_group":"PROCESS_GROUP-1CF7F9436E8B8C54","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-08D2FF4FDE9168E3","dt.entity.process_group_instance.name":"snap","carbon_per_process":0.010062264476957282},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-1CF7F9436E8B8C54","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-94E05002D1692C4F","dt.entity.process_group_instance.name":"snap","carbon_per_process":0.0051632937170003656},{"dt.entity.host":"HOST-A45FB8F21C55EBAD","dt.entity.process_group":"PROCESS_GROUP-68B404144F1EFBEA","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-68F9ACA983134625","dt.entity.process_group_instance.name":"systemd-resolved","carbon_per_process":0.004260040980764897},{"dt.entity.host":"HOST-C25D04CF17D4A5C0","dt.entity.process_group":"PROCESS_GROUP-BFC8D58C3E6C898B","dt.entity.process_group_instance":"PROCESS_GROUP_INSTANCE-38D2C66905C7B398","dt.entity.process_group_instance.name":"gosu","carbon_per_process":0}],"metadata":{"grail":{"canonicalQuery":"fetch dt.entity.process_group_instance\n| fields entity.name, dt.entity.host = belongs_to[dt.entity.host], dt.entity.process_group = instance_of[dt.entity.process_group], dt.entity.process_group_instance = id\n| lookup \n\t[\n\t\tfetch bizevents\n\t\t| filter event.type == \"carbon.measurement\"\n\t\t| summarize by:{dt.entity.host}, sum = sum(carbon.emissions)\n\t], sourceField:dt.entity.host, lookupField:dt.entity.host, prefix:\"carbon.\"\n| filter isNotNull(carbon.sum)\n| lookup \n\t[\n\t\ttimeseries by:{dt.entity.process_group_instance}, ts = avg(dt.process.cpu.usage)\n\t\t| fields cpu_sum = arraySum(ts), dt.entity.process_group_instance\n\t], sourceField:dt.entity.process_group_instance, lookupField:dt.entity.process_group_instance\n| fieldsAdd cpu_sum = lookup.cpu_sum\n| fieldsRename carbon_per_host = carbon.sum\n| fieldsRemove \"lookup*\"\n| lookup \n\t[\n\t\ttimeseries by:{dt.entity.process_group_instance}, ts = avg(dt.process.cpu.usage)\n\t\t| lookup [fetch dt.entity.process_group_instance], sourceField:dt.entity.process_group_instance, lookupField:id\n\t\t| fields ts, dt.entity.process_group_instance, dt.entity.host = lookup.belongs_to[dt.entity.host]\n\t\t| lookup [fetch dt.entity.process_group_instance], sourceField:dt.entity.process_group_instance, lookupField:id\n\t\t| fieldsAdd cpusum = arraySum(ts)\n\t\t| summarize by:{dt.entity.host}, cpuHostSum = sum(cpusum)\n\t], sourceField:dt.entity.host, lookupField:dt.entity.host\n| fieldsAdd carbon_per_process = if(isNull(cpu_sum), 0, else:cpu_sum) / lookup.cpuHostSum * carbon_per_host\n| fields dt.entity.host, dt.entity.process_group, dt.entity.process_group_instance, dt.entity.process_group_instance.name = entity.name, carbon_per_process\n| sort carbon_per_process desc","timezone":"Z","query":"//Example of emissions by processes\nfetch dt.entity.process_group_instance\n| fields entity.name, dt.entity.host=belongs_to[dt.entity.host],\n  dt.entity.process_group= instance_of[dt.entity.process_group],\n  dt.entity.process_group_instance = id\n| lookup sourceField:dt.entity.host, lookupField:dt.entity.host, [fetch bizevents\n  | filter event.type==\"carbon.measurement\"\n  | summarize sum = sum(carbon.emissions), by:{dt.entity.host}], prefix:\"carbon.\"\n| filter isNotNull(carbon.sum)\n| lookup [timeseries ts=avg(dt.process.cpu.usage), \n  by:{dt.entity.process_group_instance}\n  | fields cpu_sum= arraySum(ts), dt.entity.process_group_instance],sourceField:dt.entity.process_group_instance, \n  lookupField:dt.entity.process_group_instance\n| fieldsAdd cpu_sum=lookup.cpu_sum\n| fieldsRename carbon_per_host=carbon.sum\n| fieldsRemove \"lookup*\"\n| lookup [timeseries ts=avg(dt.process.cpu.usage),  by:{dt.entity.process_group_instance}\n  | lookup [fetch dt.entity.process_group_instance], sourceField:dt.entity.process_group_instance, lookupField:id\n  | fields ts, dt.entity.process_group_instance, dt.entity.host = lookup.belongs_to[dt.entity.host]\n  | lookup [fetch dt.entity.process_group_instance], sourceField:dt.entity.process_group_instance, lookupField:id\n  | fieldsAdd cpusum = arraySum(ts)\n  | summarize cpuHostSum = sum(cpusum), by:{dt.entity.host}],\n  sourceField:dt.entity.host, lookupField:dt.entity.host\n| fieldsAdd carbon_per_process = (if(isNull(cpu_sum),0,else:cpu_sum)/lookup.cpuHostSum) * carbon_per_host\n| fields dt.entity.host,dt.entity.process_group, dt.entity.process_group_instance, \n  dt.entity.process_group_instance.name = entity.name, carbon_per_process\n| sort carbon_per_process desc \n\n","scannedRecords":8207568,"dqlVersion":"V1_0","scannedBytes":349388172,"scannedDataPoints":54888,"analysisTimeframe":{"start":"2024-07-30T15:00:00.000Z","end":"2024-08-06T16:00:00.000Z"},"locale":"und","executionTimeMilliseconds":332,"notifications":[],"queryId":"e59029bf-cf9e-4ec7-8004-91e59e3db668","sampled":false},"metrics":[{"metric.key":"dt.process.cpu.usage","fieldName":"ts"}]},"types":[{"mappings":{"dt.entity.host":{"type":"string"},"dt.entity.process_group":{"type":"string"},"dt.entity.process_group_instance":{"type":"string"},"dt.entity.process_group_instance.name":{"type":"string"},"carbon_per_process":{"type":"double"}},"indexRange":[0,84]}]},"notifications":[],"dateTime":"2024-08-06T15:13:18.387Z","input":{"timeframe":{"from":"now-7d","to":"now","details":{"from":{"type":"expression","normalized":"now-7d","date":"2024-03-19T11:45:46.715Z"},"to":{"type":"expression","normalized":"now","date":"2024-03-26T11:45:46.715Z"}}},"value":"//Example of emissions by processes\nfetch dt.entity.process_group_instance\n| fields entity.name, dt.entity.host=belongs_to[dt.entity.host],\n  dt.entity.process_group= instance_of[dt.entity.process_group],\n  dt.entity.process_group_instance = id\n| lookup sourceField:dt.entity.host, lookupField:dt.entity.host, [fetch bizevents\n  | filter event.type==\"carbon.measurement\"\n  | summarize sum = sum(carbon.emissions), by:{dt.entity.host}], prefix:\"carbon.\"\n| filter isNotNull(carbon.sum)\n| lookup [timeseries ts=avg(dt.process.cpu.usage), \n  by:{dt.entity.process_group_instance}\n  | fields cpu_sum= arraySum(ts), dt.entity.process_group_instance],sourceField:dt.entity.process_group_instance, \n  lookupField:dt.entity.process_group_instance\n| fieldsAdd cpu_sum=lookup.cpu_sum\n| fieldsRename carbon_per_host=carbon.sum\n| fieldsRemove \"lookup*\"\n| lookup [timeseries ts=avg(dt.process.cpu.usage),  by:{dt.entity.process_group_instance}\n  | lookup [fetch dt.entity.process_group_instance], sourceField:dt.entity.process_group_instance, lookupField:id\n  | fields ts, dt.entity.process_group_instance, dt.entity.host = lookup.belongs_to[dt.entity.host]\n  | lookup [fetch dt.entity.process_group_instance], sourceField:dt.entity.process_group_instance, lookupField:id\n  | fieldsAdd cpusum = arraySum(ts)\n  | summarize cpuHostSum = sum(cpusum), by:{dt.entity.host}],\n  sourceField:dt.entity.host, lookupField:dt.entity.host\n| fieldsAdd carbon_per_process = (if(isNull(cpu_sum),0,else:cpu_sum)/lookup.cpuHostSum) * carbon_per_host\n| fields dt.entity.host,dt.entity.process_group, dt.entity.process_group_instance, \n  dt.entity.process_group_instance.name = entity.name, carbon_per_process\n| sort carbon_per_process desc \n\n"},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"drilldownPath":[]}]}